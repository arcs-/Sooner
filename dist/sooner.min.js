!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.Sooner=b()}(this,function(){function onClick(a){if(!a.defaultPrevented&&2!=a.which&&4!=a.button){for(var b,c=!1,d=0;b=a.path[d];d++)if("A"===b.tagName&&b.href&&!hasAttribute(b,"passthrough")){c=!0;break}!c||b.hostname&&-1===Settings.hostname.indexOf(b.hostname)||(a.preventDefault(),Sooner.navigate(b.href))}}function onSubmit(a){if(!a.defaultPrevented&&!hasAttribute(a.target,"passthrough")){a.preventDefault(),Settings.events.beginLoad();for(var b=a.target.getAttribute("action")||window.location.href,c=a.target.elements,d={},e=function(a,b){b||(b=""),d[a]?d[a].constructor===Array?d[a].push(b):d[a]=[d[a],b]:d[a]=b},f=0;f<c.length;f++){var g=c.item(f);if(g.name&&!g.disabled)if(g.type)if("checkbox"==g.type||"radio"==g.type)g.checked&&e(g.name,g.value);else if("select-multiple"==g.type)for(var h,i=0;h=g.options[i++];)h.selected&&e(g.name,h.value);else"file"==g.type?e(g.name,g.files):"submit"==g.type?g===document.activeElement&&e(g.name,g.value):e(g.name,g.value);else e(g.name,g.value)}if("get"===a.target.method){b.indexOf("?")>=0&&(b=b.split("?")[0]);for(var j in d)d.hasOwnProperty(j)&&"string"==typeof d[j]&&(b+=(b.indexOf("?")>=0?"&":"?")+encode(j)+"="+encode(d[j]));d=!1}Sooner.getJSON(a.target.method,b,d,function(c,d,e){if(c)return Settings.onError(c,b,a.target.method,function(a){Sooner.render.apply(this,a),Settings.events.endLoad()});Sooner.render(d,e.responseURL)})}}function htmlRender(a,b,c){var d=Settings.wrapper.getElementsByTagName("script");executeScript(d,"end"),Settings.wrapper.innerHTML=a,Settings.componentRefresh(JSON.clone(c)),b&&b.length>0&&(window.history.pushState(c,document.title,b),Settings.scrollTop&&(window.location.hash.substr(1)?scrollTo(document.getElementById(window.location.hash.substr(1))):scroll(0,0)));for(var e,f=Settings.wrapper.getElementsByTagName("input"),g=0;e=f[g];g++)if(e.hasAttribute("autofocus")){e.focus();break}Settings.events.progressLoad(),d=Settings.wrapper.getElementsByTagName("script"),loadExternalScripts(d,function(){executeScript(d,"initialize"),Settings.events.endLoad()})}function executeScript(userScripts,name){for(var name=name.toLowerCase(),userScript,i=0;userScript=userScripts[i];i++){try{hasAttribute(userScript,name)&&eval("(function(){"+userScript.innerHTML+"}())")}catch(a){console.error(a)}Settings.events.progressLoad()}}function loadExternalScripts(a,b){var c=a.length;c||b();for(var d,e=0;d=a[e];e++)if(!d.src||domUserScripts.indexOf(d.src)>-1)0==--c&&b();else{var f=document.createElement("script");f.src=d.src,f.addEventListener("load",function(){Settings.events.progressLoad(),0==--c&&b()}),domUserScripts.push(d.src),document.head.appendChild(f)}}function hasAttribute(a,b){return!(!a||!a.hasAttribute)&&(a.hasAttribute("sooner")&&a.getAttribute("sooner").toLowerCase()==b)}function stringToURL(a){var b=document.createElement("a");return b.href=a,b.cloneNode(!1)}function encode(a){return encodeURIComponent(a).replace(/%20/g,"+")}function easeOutCubic(a,b,c,d){return a/=d,a--,c*(a*a*a+1)+b}function scrollTo(a){var b=window.pageYOffset,c=Date.now(),d=a.offsetTop-window.pageYOffset-10,e=Settings.scrollSpeed,f=window.innerHeight+window.pageYOffset;!function a(){var g=Date.now(),h=easeOutCubic(g-c,b,d,e);c+e>g&&(d<0||f<document.body.offsetHeight)?(requestAnimationFrame(a),window.scrollTo(window.scrollX,h)):window.scrollTo(window.scrollX,b+d)}()}var Sooner={};Sooner.version="0.0.1";var Settings=Sooner.settings={hostname:["localhost"],wrapper:document.getElementById("wrapper"),scrollTop:!0,scrollSpeed:1e3,events:{beginLoad:function(){},progressLoad:function(){},endLoad:function(){}},componentRefresh:function(a){},render:function(a,b){document.title="sooner.js",b("<b>Implement a renderer for sooner.js</b><br><br><pre><code>"+JSON.stringify(a,null,2)+"</code></pre>")},onError:function(a,b,c,d){d([{title:"Ups",view:"error",error:a},b])}},domUserScripts=[];return function(){for(var a,b=document.getElementsByTagName("script"),c=0;a=b[c];c++)a.src&&domUserScripts.push(a.src)}(),document.addEventListener("click",onClick,!1),document.addEventListener("submit",onSubmit,!1),window.addEventListener("popstate",function(a){Settings.events.beginLoad(),a.state&&Sooner.render(a.state)}),window.addEventListener("beforeunload",function(a){executeScript(Settings.wrapper.getElementsByTagName("script"),"end")}),Sooner.configure=function(a){var b,c;for(b in a)void 0!==(c=a[b])&&a.hasOwnProperty(b)&&(Settings[b]=c);return this},Sooner.navigate=function(a){if(-1===Settings.hostname.indexOf(stringToURL(a).hostname))return window.location.href=a;if(stringToURL(a).pathname,window.location.pathname&&a.indexOf("#")>-1){var b=document.getElementById(a.substr(a.indexOf("#")+1));return b?(window.history.replaceState(void 0,void 0,"#"+b.id),void scrollTo(b)):console.error("invalid anchor tag",a)}Settings.events.beginLoad(),Sooner.getJSON("get",a,!1,function(b,c,d){if(b)return Settings.onError(b,a,"get",function(a){Sooner.render.apply(this,a),Settings.events.endLoad()});var e=a.indexOf("#")>-1?a.substring(a.indexOf("#")):"";Sooner.render(c,d.responseURL?d.responseURL+e:a)})},Sooner.reload=function(){Sooner.navigate(window.location)},Sooner.render=function(a,b){Settings.render(a,function(c){htmlRender(c,b,a)})},Sooner.getJSON=function(a,b,c,d){var d=d||function(){},e=new XMLHttpRequest;e.open(a,b),e.setRequestHeader("Accept","application/json"),e.onload=function(){if(200===this.status){try{var a=JSON.parse(e.responseText)}catch(a){return d({status:this.status,statusText:"Invalied JSON response",content:e.responseText})}d(null,a,e)}else d({status:this.status,statusText:e.statusText})},e.onerror=function(){d({status:this.status,statusText:e.statusText})},c?(e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(c))):e.send()},"path"in Event.prototype||Object.defineProperty(Event.prototype,"path",{get:function(){for(var a=[],b=this.target;b;)a.push(b),b=b.parentElement;return-1===a.indexOf(window)&&-1===a.indexOf(document)&&a.push(document),-1===a.indexOf(window)&&a.push(window),a}}),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),"function"!=typeof JSON.clone&&(JSON.clone=function(a){return JSON.parse(JSON.stringify(a))}),Sooner});